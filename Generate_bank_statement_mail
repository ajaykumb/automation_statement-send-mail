#!/bin/bash
# Generate bank statement & send via email
# Author: Ajay Kumar Behera

DB_USER="bank_user"
DB_PASS="akbehera"
DB_NAME="bankdb"
ACCOUNT_NO="1234567890"
REPORT="/tmp/statement_${ACCOUNT_NO}_$(date +%F).csv"
EMAIL="oracle.ajaykr@gmail.com"

# Step 1: Generate CSV report from DB
mysql -u$DB_USER -p$DB_PASS -D$DB_NAME -e "
SELECT txn_date, txn_type, amount, balance
FROM transactions
WHERE account_no='$ACCOUNT_NO'
ORDER BY txn_date;" \
| sed 's/\t/,/g' > $REPORT

# Step 2: Add header row
sed -i '1s/^/Date,Type,Amount,Balance\n/' $REPORT

# Step 3: Send report via email with attachment
echo "Dear Client, please find attached your account statement." | mail -s "Account Statement - $ACCOUNT_NO" -a $REPORT $EMAIL

# Step 4: Verify
if [ $? -eq 0 ]; then
    echo "Statement report sent successfully to $EMAIL"
    exit 0
else
    echo "Failed to send statement report"
    exit 1
fi
